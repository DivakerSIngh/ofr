@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutIntranet.cshtml";
}

@*<link href="~/css/jquery-ui.css" rel="stylesheet" />*@
<script src="~/js/Jquery1.10.3.js"></script>
<script src="~/js/jquery.validate.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
<script src="~/js/jquery-ui.js"></script>
<script type="text/javaScript">
    $(document).ready(function () {
        $('#single').keypress(function (event) {
            return isNumeric(event, this, 9)
        });
        $('#double').keypress(function (event) {
            return isNumeric(event, this, 9)
        });
        $('#triple').keypress(function (event) {
            return isNumeric(event, this, 9)
        });
        $('#quad').keypress(function (event) {
            return isNumeric(event, this, 9)
        });
        $('#quin').keypress(function (event) {
            return isNumeric(event, this, 9)
        });
        $('#Inv').keypress(function (event) {
            return isInteger(event, this, 3)
        });
        $('#CutOff').keypress(function (event) {
            return isInteger(event, this, 3)
        });
        $('#Min').keypress(function (event) {
            return isInteger(event, this, 3)
        });
        $('#Max').keypress(function (event) {
            return isInteger(event, this, 3)
        });
    });


    var dates = [];
    function makeCalendar(dateFrom, dateTo, controlId, sDates, yDates, ddays) {
        ddays = (ddays == undefined) ? [] : ddays;
        var bg = "#FFFFE1",
        fs = 3,
        flg = 0,
        M = new Array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"),
        D = new Array("S", "M", "T", "W", "T", "F", "S"),
        pdy, pmo, pyr, yr, bgn, mo, dy, d, ld, pos, ctr;
        function calendarWork() {
            var html = "";
            var df = dateFrom.split("/"),
                dt = dateTo.split("/");
            pdy = new Date(df[2], df[0] - 1, df[1]),
            pdt = new Date(dt[2], dt[0] - 1, dt[1]),
            pmo = pdy.getMonth();    // present month
            pyr = pdy.getYear();     // present year
            var tempsDates = sDates,
            tempyDates = yDates;
            if (pyr < 2000)
                pyr = pyr + 1900;
            //html += '<TABLE BORDER=0 class="table"><TR>';
            html += '<div class="row"><div class="col-md-2">';

            var months;
            var MonthDiff = 12 * (pdt.getYear() - pdy.getYear());
            if (MonthDiff == 0) {
                MonthDiff = 12;
            }
            if (((pdt.getYear() + 1900) - pyr) > 0) {
                months = MonthDiff - pdy.getMonth() + pdt.getMonth();
            } else {
                months = pdt.getMonth() - pdy.getMonth();
            }
            for (var m = 0; m <= months; m++) {
                //html += '</TD><TD VALIGN=TOP>';
                if (m > 0) {
                    if (m % 6 == 0) {
                        html += '</div></div><div class="row"><div class="col-md-2">';
                    }
                    else {
                        html += '</div><div class="col-md-2">';
                    }
                }
                yr = pyr; // last month's year
                mo = pmo + m;
                if (mo > 11) {
                    mo = mo - 12;
                    yr = yr + 1;
                }
                if (mo > 11) {
                    mo = mo - 12;
                    yr = yr + 1;
                }
                bgn = new Date(M[mo] + " 1," + yr);
                var selectDate = {
                    green: [],
                    yellow: []
                };
                for (var k = 0; k < tempsDates.length; k++) {
                    var sd = new Date(tempsDates[k]);

                    if (sd.getMonth() === mo && (sd.getYear() + 1900) === yr) {
                        selectDate.green.push(sd.getDate());
                    }
                }
                for (var k = 0; k < tempyDates.length; k++) {
                    var sd = new Date(tempyDates[k]);

                    if (sd.getMonth() === mo && (sd.getYear() + 1900) === yr) {
                        selectDate.yellow.push(sd.getDate());
                    }
                }


                if (months === 0) {
                    html += getCalendar(selectDate, pdy.getDate(), 'beforeafter', pdy.getDate(), pdt.getDate());
                } else {
                    if (yr === pyr && mo === pmo) {
                        html += getCalendar(selectDate, pdy.getDate(), 'before');
                    } else if (yr === (pdt.getYear() + 1900) && mo === pdt.getMonth()) {
                        html += getCalendar(selectDate, pdt.getDate(), 'after');
                    } else {
                        html += getCalendar(selectDate);
                    }
                }

            }
            //html += '</TD></TR></TABLE>';
            html += '</div></div>';
            document.getElementById(controlId).innerHTML = html;
            var prependZero = function (number) {
                return number < 10 ? '0' + number : number;
            },
            days = document.getElementsByClassName("day");
            for (var i = 0, j = days.length; i < j; i++) {
                days[i].addEventListener('click', function (e) {
                    var x = e.target.parentElement.parentElement.parentElement.title.split('-'),
                    month = parseInt(x[0], 10),
                    day = parseInt(e.target.innerHTML, 10),
                    year = parseInt(x[1], 10),
                    date = prependZero(month) + '/' + prependZero(day) + '/' + year;
                    if (e.target.style.backgroundColor == 'lightgreen') {
                        e.target.style.backgroundColor = '';
                        if (dates.length > 0) {
                            var index = dates.indexOf(date)
                            if (index > -1) {
                                dates.splice(index, 1);
                                document.getElementById('SavedDates').value = dates.join('$');

                            }
                        }

                    } else {
                        var d1 = dateFrom.split("/"),
                        d2 = dateTo.split("/"),
                        from = new Date(d1[2], d1[0] - 1, d1[1]),
                        to = new Date(d2[2], d2[0] - 1, d2[1]),
                        check = new Date(year, month - 1, day);
                        if (check >= from && check <= to) {
                            e.target.style.backgroundColor = 'lightgreen';
                            dates.push(date);
                            document.getElementById('SavedDates').value = dates.join('$');
                        }
                    }

                }, false);
            }
        }

        function getCalendar(sds, dd, mode, before, after) {
            var html = "";
            dy = bgn.getDay();
            yr = eval(yr);
            d = "312831303130313130313031";
            if (yr / 4 == Math.floor(yr / 4)) {
                d = d.substring(0, 2) + "29" + d.substring(4, d.length);
            }
            pos = (mo * 2);
            ld = eval(d.substring(pos, pos + 2));
            html += "<TABLE class='month' title= '" + (mo + 1) + '-' + yr + "' BORDER=0" + " BGCOLOR='" + bg + "'><TR><TD ALIGN=CENTER COLSPAN=7  style='background-color: gray; color: white;' class='monthClick' p= '" + (mo + 1) + '-' + yr + "'>" + "<FONT SIZE=" + fs + ">" + M[mo] + " " + yr + "</FONT></TD></TR><TR><TR class='weeks'>";
            for (var i = 0; i < 7; i++) {
                html += "<TD class='days'>" + D[i] + "</TD>";
            }
            html += "</TR><TR>";
            ctr = 0;



            var x = ld;
            //if (dy > 4 && ld > 30) {
            //    x--;
            //}
            //if (dy > 5 && ld > 29) {
            //    x -= 1;
            //}

            var checkClass = function (y, selDate) {
                var cls = '';
                if (selDate) {
                    cls = ' ofrday';
                } else {
                    if (sds.green.indexOf(y) != -1) {
                        cls = 'selected day';
                    }
                    else if (sds.yellow.indexOf(y) != -1) {
                        cls = 'less-than-five day';
                    }
                    else if (mode) {
                        if (mode == 'before' && y < dd) {
                            cls += ' ofrday';
                        } else if (mode === 'after' && y > dd) {
                            cls += ' ofrday';
                        }
                        else if (mode === 'beforeafter' && (y < before || y > after)) {
                            cls += ' ofrday';
                        }
                        else {
                            cls += 'zero day';
                        }
                    } else {
                        cls += 'zero day';
                    }
                }
                var y1 = y < 10 ? "0" + y : y;
                var mo1 = (mo + 1) < 10 ? "0" + (mo + 1) : (mo + 1);
                var tempid = y1 + "-" + mo1 + "-" + yr;
                html += "<TD id=" + tempid + " class='" + cls + "'>" + y + "</TD>";
            },
            fillHtml1 = function (i1, selDate) {
                if (i1 < dy) {

                    if (dy > 4 && ld > 30 && x < ld) {
                        if (x <= ld) {
                            x++;
                            checkClass(x, selDate);
                        }
                    }
                    else if (dy > 5 && ld > 29 && x < ld) {
                        if (x <= ld) {
                            x++;
                            checkClass(x, selDate);
                        }
                    } else {
                        html += "<TD></TD>";
                    }
                }
                else {
                    ctr++;
                    checkClass(ctr, selDate);
                }
            },
            fillHtml2 = function (selDate) {
                ctr++;
                if (ctr > ld) {
                    html += "<TD>" + " </TD>";
                }
                else {
                    checkClass(ctr, selDate);
                }
            };



            for (var i = 0; i < 7; i++) {
                if (ddays.indexOf(i) != -1) {
                    fillHtml1(i, true);
                } else {
                    fillHtml1(i, false);
                }
            }
            html += "</TR><TR>";
            var rows = 0;
            while (rows < 5) {
                for (var i = 0; i < 7; i++) {
                    if (ddays.indexOf(i) != -1) {
                        fillHtml2(true);
                    }
                    else {
                        fillHtml2(false);
                    }
                }
                html += "</TR><TR>";

                rows++;
            }
            html += "</TR></TABLE>";
            return html;
        }

        calendarWork();
    }

    function ReadyForCalendar() {
        var FromDate, ToDate;
        var NoOfMonths = parseInt($("input[name='months']:checked").val());
        var date = new Date();
        var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        var lastDay = "";
        var Y = date.getFullYear();
        var M = date.getMonth();
        if (NoOfMonths + M > 23) {
            lastDay = new Date(Y + 2, M + NoOfMonths - 24, 0);
        }
        else if (NoOfMonths + M > 11) {
            lastDay = new Date(Y + 1, M + NoOfMonths - 12, 0);
        }
        else {
            lastDay = new Date(Y, M + NoOfMonths, 0);
        }

        // Set last date for calendars

        var d = new Date();
        $('#FromDate').removeClass('hasDatepicker').datepicker({
            startDate: d,
            minDate: d,
            autoclose: true,
            maxDate: lastDay,
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true,
            onClose: function (selectedDate) {
                $("#ToDate").datepicker("option", "minDate", selectedDate);
            }
        });

        $('#ToDate').removeClass('hasDatepicker').datepicker({
            startDate: d,
            minDate: d,
            autoclose: true,
            maxDate: lastDay,
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true//,
            //onClose: function (selectedDate) {
            //    $("#FromDate").datepicker("option", "maxDate", selectedDate);
            //}
        });

        //End

        var firstDate = (firstDay.getMonth() + 1) + '/' + firstDay.getDate() + '/' + firstDay.getFullYear();
        var lastDate = (lastDay.getMonth() + 1) + '/' + lastDay.getDate() + '/' + lastDay.getFullYear();

        var OffDays = [], SelectedDates = [];

        $("input[name='Date']:not(:checked)").each(function () {
            OffDays.push(parseInt($(this).val()));
        });

        if ($('#FromDate').val() == '' && $('#ToDate').val() != '') {
            toastr.warning('Please provide Start Date');
            return;
        }

        if ($('#FromDate').val() != '' && $('#ToDate').val() == '') {
            toastr.warning('Please provide End Date');
            return;
        }

        if ($('#FromDate').val() != '' && $('#ToDate').val() != '') {
            var FD = $('#FromDate').val().split("/");
            var TD = $('#ToDate').val().split("/");

            FromDate = new Date(FD[2], FD[1] - 1, FD[0]);
            ToDate = new Date(TD[2], TD[1] - 1, TD[0]);

            if ((FromDate < firstDay && ToDate < firstDay) || (FromDate > lastDay && ToDate > lastDay)) {
                toastr.warning('Dates are out of range');
                return;
            }

            if (FromDate >= ToDate) {
                toastr.warning('End Date should be greater than Start Date');
                return;
            }

            if (FromDate < firstDay) {
                FromDate = firstDay;
            }

            if (ToDate > lastDay) {
                ToDate = lastDay;
            }
        }
        dates.length = 0;
        makeCalendar(firstDate, lastDate, 'calendarControl', SelectedDates, [], OffDays);

        //SelectedDates.push(FromDate);
        while (FromDate <= ToDate) {
            var y1 = FromDate.getDate() < 10 ? "0" + FromDate.getDate() : FromDate.getDate();
            var mo1 = (FromDate.getMonth() + 1) < 10 ? "0" + (FromDate.getMonth() + 1) : (FromDate.getMonth() + 1);
            var tempid = y1 + "-" + mo1 + "-" + FromDate.getFullYear();
            FromDate = new Date(FromDate.getFullYear(), FromDate.getMonth(), FromDate.getDate() + 1);
            var l = document.getElementById(tempid);
            l.click();
        }

        $(".monthClick").click(function () {
            var a = $(this).attr("p");

            var SelectedMonth = a.split("-")[0];
            var SelectedYear = a.split("-")[1];

            var FromDate = new Date(SelectedYear, SelectedMonth - 1, 1);
            var ToDate = new Date(SelectedYear, SelectedMonth, 0);

            //console.log(FromDate);
            //console.log(ToDate);

            var AA = $("td[id$='" + a + "']").filter('.day');

            var selected = [], unselected = [];

            for (var i = 0; i < AA.length; i++) {
                if (AA[i].style.backgroundColor == 'lightgreen')
                    selected.push(AA[i].id);
                else
                    unselected.push(AA[i].id);
            }

            if (unselected.length > 0)
                for (var i = 0; i < unselected.length; i++) {
                    var l = document.getElementById(unselected[i]);
                    l.click();
                }
            else
                for (var i = 0; i < selected.length; i++) {
                    var l = document.getElementById(selected[i]);
                    l.click();
                }
        });
    }



    function checkMain(cb) {
        if (!cb.checked) {
            $("input[name='" + cb.value + "']").each(function () {
                $(this).prop("checked", cb.checked);
            });
        }
    }

    function checkAll(cb) {
        $("input[name='" + cb.name + "']").each(function () {
            $(this).prop("checked", cb.checked);
        });

        $("input[value='" + cb.name + "']").prop("checked", true);
    }

    function RoomCheck(cb) {
        $("input[value='" + cb.name + "']").prop("checked", true);

        var id = "";
        var count = 0;
        var AllChecked = true;

        $("input[name='" + cb.name + "']").each(function () {
            if (count == 0) {
                id = $(this).prop("id");
            }
            else {
                if ($(this).prop("checked") == false) {
                    AllChecked = false;
                }
            }
            count++;
        });

        $("input[id='" + id + "']").prop("checked", AllChecked);
    }

    $(document).ready(function () {

        var date = new Date();
        var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        var lastDay = "";
        var Y = date.getFullYear();
        var M = date.getMonth();
        if (6 + M > 11) {
            lastDay = new Date(Y + 1, M + 6 - 12, 0);
        }
        else {
            lastDay = new Date(Y, M + 6, 0);
        }

        // Set last date for calendars

        var d = new Date();
        $('#FromDate').datepicker({
            startDate: d,
            minDate: d,
            autoclose: true,
            maxDate: lastDay,
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true,
            onClose: function (selectedDate) {
                $("#ToDate").datepicker("option", "minDate", selectedDate);
            }
        });

        $('#ToDate').datepicker({
            startDate: d,
            minDate: d,
            autoclose: true,
            maxDate: lastDay,
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true,
            onClose: function (selectedDate) {
                $("#FromDate").datepicker("option", "maxDate", selectedDate);
            }
        });

        $("input[name='months']").change(function () {
            ReadyForCalendar();
        });

        ReadyForCalendar();

        GetRoomRatePlan();

        $("input[name='chkPriceChange']").change(function () {
            var chk = parseInt($("input[name='chkPriceChange']:checked").val());
            if (chk == 1) {
                $("#Rates").show();
            }
            else {
                $("#Rates").hide();
            }
            GetRoomRatePlan();
        });

        //$("input[id='chkPriceChange']").change(function () {
        //    var chk = $(this).prop("checked");
        //    if (chk) {
        //        $("#Rates").show();
        //    }
        //    else {
        //        $("#Rates").hide();
        //    }
        //    GetRoomRatePlan();
        //});
        $("#Rates").hide();

        $("#ui-datepicker-div").hide();


    });

    function GetRoomRatePlan() {
        values = {
            OnlyBase: parseInt($("input[name='chkPriceChange']:checked").val()) == 1 ? true : false
        }
        var Data = $.parseJSON(AjaxCallWithDataMVC("@Url.Action("GetRoomAndRatePlan")", values));
        var html = "";
        var AllRooms = Data.msg.split(';');
        for (var i = 0; i < AllRooms.length ; i++) {
            var RoomAndPlanSplitter = AllRooms[i].split('#');
            var RoomName = RoomAndPlanSplitter[0].split('$');
            html += "<div class=\"col-md-3\"><input type=\"checkbox\" name=\"MainSelect\" id=\"" + RoomName[0] + "\" value=\"" + RoomName[1] + "\" onchange=\"checkMain(this);\">&nbsp;" + RoomName[1] + "</div>";
            html += "<div class=\"col-md-9\"><div class=\"col-md-12\"> <input type=\"checkbox\" name=\"" + RoomName[1] + "\" id=\"Select_" + i + "\" onchange=\"checkAll(this);\">&nbsp;<b>Select All</b> &nbsp;</div>";

            var Plans = RoomAndPlanSplitter[1].split(',');
            for (var j = 0; j < Plans.length; j++) {
                var PlanName = Plans[j].split('$');
                html += "<div class=\"col-md-12\"> <input type=\"checkbox\" name=\"" + RoomName[1] + "\" id=\"" + PlanName[0] + "\" onchange=\"RoomCheck(this);\">&nbsp;" + PlanName[1] + " &nbsp;</div>";
            }
            html += "</div><hr />";

        }
        $('#RoomsAndRates').html("");
        $('#RoomsAndRates').html(html);
    }

    function save() {
        if (parseInt($('#Max').val().trim()) != 'NaN' && (parseInt($('#Max').val().trim()) < 0 || parseInt($('#Max').val().trim()) > 100)) {
            return false;
        }

        if (parseInt($('#Min').val().trim()) != 'NaN' && (parseInt($('#Min').val().trim()) < 0 || parseInt($('#Min').val().trim()) > 100)) {
            return false;
        }

        if (parseInt($('#CutOff').val().trim()) != 'NaN' && (parseInt($('#CutOff').val().trim()) < 0 || parseInt($('#CutOff').val().trim()) > 100)) {
            return false;
        }

        if (parseInt($('#Inv').val().trim()) != 'NaN' && (parseInt($('#Inv').val().trim()) < 0 || parseInt($('#Inv').val().trim()) > 999)) {
            return false;
        }

        if (dates.length == 0) {
            toastr.error('Please select a date from calendar.');
            return;
        }

        if (dates.length > 94) {
            toastr.error('Maximum 94 days can be selected at a time from calendar. Currently ' + dates.length + ' days have been selected.');
            return;
        }
        else {
            var chk = parseInt($("input[name='chkPriceChange']:checked").val());

            if (chk == 1) {
                if ($('#single').val().trim().indexOf("e") > -1) {
                    toastr.error('Single rate cannot be an exponential number.');
                    return;
                }

                if ($('#double').val().trim().indexOf("e") > -1) {
                    toastr.error('Double rate cannot be an exponential number.');
                    return;
                }

                if ($('#triple').val().trim().indexOf("e") > -1) {
                    toastr.error('Triple rate cannot be an exponential number.');
                    return;
                }

                if ($('#quad').val().trim().indexOf("e") > -1) {
                    toastr.error('Quadruple rate cannot be an exponential number.');
                    return;
                }

                if ($('#quin').val().trim().indexOf("e") > -1) {
                    toastr.error('Quintuple rate cannot be an exponential number.');
                    return;
                }
            }

            if (chk && ($('#Inv').val().trim() == "" && $('#StopSell').val().trim() == "" && $('#CutOff').val().trim() == "" && $('#CloseOut').val().trim() == "" && $('#Min').val().trim() == "" && $('#Max').val().trim() == "" && $('#CTA').val().trim() == "" && $('#CTD').val().trim() == "" && $('#single').val().trim() == "" && $('#double').val().trim() == "" && $('#triple').val().trim() == "" && $('#quad').val().trim() == "" && $('#quin').val().trim() == "")) {
                toastr.error('Please provide a text field value.');
                return;
            }
            else if (!chk && ($('#Inv').val().trim() == "" && $('#StopSell').val().trim() == "" && $('#CutOff').val().trim() == "" && $('#CloseOut').val().trim() == "" && $('#Min').val().trim() == "" && $('#Max').val().trim() == "" && $('#CTA').val().trim() == "" && $('#CTD').val().trim() == "")) {
                toastr.error('Please provide a text field value.');
                return;
            }

            if ($('#Min').val().trim() == "" && $('#Max').val().trim() != "") {
                toastr.error('Please provide min value as well.');
                return;
            }

            if ($('#Min').val().trim() != "" && $('#Max').val().trim() == "") {
                toastr.error('Please provide max value as well.');
                return;
            }

            if ($('#Min').val().trim() != "" && $('#Max').val().trim() != "" && parseInt($('#Min').val().trim()) > parseInt($('#Max').val().trim())) {
                toastr.error('Min value cannot be greater than max value.');
                return;
            }

            if (($('#Min').val().trim() == "0" && $('#Max').val().trim() != "0") || ($('#Min').val().trim() != "0" && $('#Max').val().trim() == "0")) {
                toastr.error('Either both Min value & Max value should be zero or none should be zero.');
                return;
            }

            var roomid = [], roomname = [], plan = [];
            $("input:checkbox[name=MainSelect]:checked").each(function () {
                roomid.push($(this).attr("id"));
                roomname.push($(this).attr("value"));
            });

            if (roomid.length == 0 && ($('#Inv').val().trim() != "" || $('#StopSell').val().trim() != "" || $('#CutOff').val().trim() != "")) {
                toastr.error('No room type selected.');
                return;
            }
            for (var i = 0; i < roomid.length; i++) {
                $("input:checkbox[name='" + roomname[i] + "']:checked").each(function () {
                    if ($(this).attr("id").toLowerCase().indexOf("select") < 0)
                        plan.push(roomid[i] + "-" + $(this).attr("id"));
                });
            }
            if (plan.length == 0 && ($('#CloseOut').val().trim() != "" || $('#Min').val().trim() != "" || $('#Max').val().trim() != "" || $('#CTA').val().trim() != "" || $('#CTD').val().trim() != "" || $('#single').val().trim() != "" || $('#double').val().trim() != "" || $('#triple').val().trim() != "" || $('#quad').val().trim() != "" || $('#quin').val().trim() != "")) {
                toastr.error('No rate plan selected.');
                return;
            }

            var values = {
                dates: dates.join('$'),
                roomid: roomid.join(),
                plan: plan.join(),
                Inv: $('#Inv').val().trim(),
                StopSell: $('#StopSell').val().trim(),
                CutOff: $('#CutOff').val().trim(),
                CloseOut: $('#CloseOut').val().trim(),
                Min: $('#Min').val().trim(),
                Max: $('#Max').val().trim(),
                CTA: $('#CTA').val().trim(),
                CTD: $('#CTD').val().trim(),
                single: chk == true ? $('#single').val().trim() : "",
                doble: chk == true ? $('#double').val().trim() : "",
                triple: chk == true ? $('#triple').val().trim() : "",
                quad: chk == true ? $('#quad').val().trim() : "",
                quin: chk == true ? $('#quin').val().trim() : ""
            };
            document.getElementById('Progress').style.display = 'block';
            setTimeout(function () {
                var Data = $.parseJSON(AjaxCallWithDataMVCPOST("@Url.Action("SaveInventory")", values));
                if (Data != null) {
                    // $('.overlay').style.display = 'none';
                    if (Data.st == '1') {
                        $('#UpdateUsers').modal({
                            show: 'true'
                        });
                        return false;
                    }
                    else if (Data.st == '2') {

                        $("#table tr:not(:first)").remove();


                        var JS = $.parseJSON(Data.msg);
                        var table = document.getElementById("table");
                        for (var i = 0; i < JS.length; i++) {
                            var row = table.insertRow(i + 1);
                            var cell1 = row.insertCell(0);
                            var cell2 = row.insertCell(1);
                            var cell3 = row.insertCell(2);
                            cell1.innerHTML = JS[i].sRatePlan;
                            cell2.innerHTML = JS[i].dtValidFrom;
                            cell3.innerHTML = JS[i].dtValidTo;
                        }

                        $('#FailDiv').modal({
                            show: 'true'
                        });
                        return false;
                    }
                    else if (Data.st == '0') {
                        toastr.error(Data.msg);
                        return false;
                    }
                }
            }, 200);

            // $('.overlay').style.display = 'none';
        }
    }

    function Overview() {
        var StartDate = $('#FromDate').val();
        window.location.href = '/BulkUpdate/GoToOverview?StartDate=' + StartDate;
    }

    function RefreshAndStay() {

        //$("input[id='chkPriceChange']").prop("checked", false);
        //$("#Rates").hide();
        GetRoomRatePlan();

        $('input[type="number"]').each(function () {
            $(this).val("");
        });

        $('select').each(function () {
            $('#' + $(this).attr("id") + ' option[value=""]').prop("selected", true);
        });

        $('span.select2-chosen').each(function () {
            $(this).text("");
        });

        $('.close').click();

        //$('.HideDiv').hide();
        //$('input[name="discount"]:checked').each(function () {
        //    $(this).prop("checked", false);
        //});



        //$('select:not([id="CTA"]):not([id="CTD"]):not([id="CloseOut"])').each(function () {
        //    $('#' + $(this).attr("id") + ' option[value="0"]').prop("selected", true);
        //});



        //$('[value="Date"').each(function () {
        //    $(this).prop("checked", false);
        //});

        //rangejson.length = 0;

        //SetTableRows();
    }

    $(function () {

        $('#btnSelectPeriod').click();
    });
</script>

<div class="container margintop20">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4>Bulk Update</h4>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-8 lightblue">

                    Select the dates for your update:<br>
                    <strong>(A)</strong> Use the start and end dates then click Select Period OR <strong>(B)</strong> Click dates directly within the calendar.

                </div>
                <div class="col-md-4 lightgreybg ">
                    <strong>View</strong> <br>
                    <input type="radio" name="months" value="6" class="radio-inline" unchecked>
                    6 Months
                    <input type="radio" name="months" value="12" class="radio-inline" checked>
                    12 Months
                    <input type="radio" name="months" value="18" class="radio-inline" unchecked>
                    18 Months
                </div>
                <!--Rate & Availability overview section Start-->
                <div class="col-md-12">
                    <h4>Rate & Availability Overview</h4>
                    <hr>
                </div>

                <div class="col-md-12">
                    <div class="col-xs-2">
                        Start Date
                        <input type="text" id="FromDate" onkeyup="this.value=''" value="@ViewBag.StartDate" name="textfield" class="form-control width65 hasDatepicker">
                    </div>
                    <div class="col-xs-2">
                        End Date
                        <input type="text" id="ToDate" name="textfield" onkeyup="this.value=''" value="@ViewBag.EndDate" class="form-control width65 hasDatepicker">
                    </div>
                </div>
                <div class="col-md-6 margintop10">
                    <strong> Include: </strong>
                    <input type="checkbox" name="Date" value="1" class="checkbox-inline" checked="checked">
                    MON
                    <input type="checkbox" name="Date" value="2" class="checkbox-inline" checked="checked">
                    TUE
                    <input type="checkbox" name="Date" value="3" class="checkbox-inline" checked="checked">
                    WED
                    <input type="checkbox" name="Date" value="4" class="checkbox-inline" checked="checked">
                    THU
                    <input type="checkbox" name="Date" value="5" class="checkbox-inline" checked="checked">
                    FRI
                    <input type="checkbox" name="Date" value="6" class="checkbox-inline" checked="checked">
                    SAT
                    <input type="checkbox" name="Date" value="0" class="checkbox-inline" checked="checked">
                    SUN
                </div>

                <div class="col-md-3  margintop10">
                    <button type="submit" class="btn btn-primary" id="btnSelectPeriod" onclick="ReadyForCalendar();">Select Period</button>
                </div>
                <div class="col-md-12"> <hr /></div>
                <div class="col-md-12 margintop10">
                    <div id="calendarControl">
                    </div>
                    <p><strong>Product Selection:</strong> All selected items will be updated with the value(s) entered below.</p>
                </div>
                <div class="col-md-2  margintop10" style="font-size: 15px; width:3%;">
                    <input type="radio" name="chkPriceChange" value="0" class="radio-inline" style="height: 20px;width: 20px;" checked>
                </div>
                <div class="col-md-3  margintop10" style="font-size: 15px;">
                    <b> Check to update inventory.</b>
                </div>
                <div class="col-md-2  margintop10" style="font-size: 15px; width:3%;">
                    <input type="radio" name="chkPriceChange" value="1" class="radio-inline" style="height: 20px;width: 20px;">
                </div>
                <div class="col-md-3  margintop10" style="font-size: 15px;">
                    <b> Check to update rate and inventory.</b>
                </div>
                <!--Rate & Availability overview section End-->
            </div>
            <!--Rate Plam Name section End-->

            <div class="marginbottom20">
                <div class="col-md-12 lightgreybg border paddingbottom10">
                    <div class="col-md-3">
                        <h5><b>ROOM TYPE</b></h5>
                    </div>
                    <div class="col-md-9">
                        <h5><b>RATE PLAN</b></h5>
                    </div>
                </div>
                <div id="RoomsAndRates" class="col-md-12 lightgreybg border "></div>
            </div>
            <!--Rate Plan Name section End-->
            <div class="clearfix"></div>
            <div class="lightgreybg border margintop35">


                <div class="col-md-12">
                    <h4> BULK EDIT</h4>
                </div>
                <div class="col-md-12"> <hr /></div>
                <div class="col-md-12">
                    <h5><b> ROOM TYPE INFORMATION</b></h5>
                </div>
                <div class="col-md-10 greylight border">
                    <div class="row">
                        <div class="col-xs-2" style="width:10%;">
                            Inventory
                            <input id="Inv" type="number" name="textfield" class="form-control" max="999" min="0" onblur="return validate(this, 999, 0);">
                        </div>
                        <div class="col-xs-2" style="width:10%;">
                            Stop Sell
                            <select id="StopSell" class="form-control">
                                <option value="">&nbsp;</option>
                                <option value="On">On </option>
                                <option value="Off">Off </option>
                            </select>
                        </div>
                        <div class="col-xs-2">
                            Cut Off
                            <input id="CutOff" type="number" name="textfield" class="form-control" max="100" min="0" onblur="return validate(this,100,0);" style="width:55%;">
                        </div>
                    </div>
                </div>


                <div class="col-md-12">
                    <h5><b>RATE PLAN INFORMATION</b></h5>
                </div>
                <div class="col-md-12 greylight border ">
                    <div class="row">
                        <div class="col-xs-1">
                            Close Out
                            <select id="CloseOut" class="form-control">
                                <option value="">&nbsp;</option>
                                <option value="On">On </option>
                                <option value="Off">Off </option>
                            </select>
                        </div>
                        <div class="col-xs-1">
                            Min Night
                            <input id="Min" type="number" name="textfield" class="form-control" max="100" min="0" onblur="return validate(this,100,0);">
                        </div>
                        <div class="col-xs-1">
                            Max Night
                            <input id="Max" type="number" name="textfield" class="form-control" max="100" min="0" onblur="return validate(this,100,0);">
                        </div>
                        <div class="col-xs-1">
                            CTA
                            <select id="CTA" class="form-control">
                                <option value="">&nbsp;</option>
                                <option value="On">On </option>
                                <option value="Off">Off </option>
                            </select>
                        </div>
                        <div class="col-xs-1">
                            CTD
                            <select id="CTD" class="form-control">
                                <option value="">&nbsp;</option>
                                <option value="On">On </option>
                                <option value="Off">Off </option>
                            </select>
                        </div>
                    </div>
                    <div class="row" id="Rates">
                        <div class="col-xs-2" style="width:13%;">
                            Single Rate
                            <input id="single" type="number" step="0.01" name="textfield" class="form-control" min="0" onblur="return validateRate(this, 0);">
                        </div>
                        <div class="col-xs-2" style="width:13%;">
                            Double Rate
                            <input id="double" type="number" step="0.01" name="textfield" class="form-control" min="0" onblur="return validateRate(this, 0);">
                        </div>
                        <div class="col-xs-2" style="width:13%;">
                            Triple Rate
                            <input id="triple" type="number" step="0.01" name="textfield" class="form-control" min="0" onblur="return validateRate(this, 0);">
                        </div>
                        <div class="col-xs-2" style="width:14%;">
                            Quadruple Rate
                            <input id="quad" type="number" step="0.01" name="textfield" class="form-control" min="0" onblur="return validateRate(this, 0);">
                        </div>
                        <div class="col-xs-2" style="width:14%;">
                            Quintuple Rate
                            <input id="quin" type="number" step="0.01" name="textfield" class="form-control" min="0" onblur="return validateRate(this, 0);">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row pull-right  marginbottom20">
    <div class="col-xs-12">
        <input name="" type="button" class="btn btn-primary" value="Save" onclick="save()">
        @*<input name="" type="button" class="btn btn-danger" value="CANCEL">*@
        <input type="hidden" id="SavedDates">
    </div>
</div>

<form id="frmUsersUpdate">
    <div id="UpdateUsers" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" style="display:none" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Success</h4>
                </div>
                <div class="modal-body">
                    <div class="row" style="margin-left:5px;margin-right:5px;">
                        The data has been saved successfully.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnUpdate" class="btn btn-primary" onclick="RefreshAndStay()">Stay here</button>
                    <button type="button" id="btnCancel" class="btn btn-primary" onclick="Overview()">Go to Overview</button>
                </div>
            </div>

        </div>
    </div>
</form>
<form id="frmUsersFail">
    <div id="FailDiv" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">FAILURE</h4>
                </div>
                <div class="modal-body">
                    <div style="margin-left:5px;margin-right:5px;">
                        The dates have been provided beyond the validity of the following rate plan(s).
                    </div>
                    <div class="row" id="tables">
                        <table id="table" border="1" style="width: 100%;text-align: center;">
                            <tr>
                                <th style="text-align: center;">Rate Plan</th>
                                <th style="text-align: center;">Valid From</th>
                                <th style="text-align: center;">Valid To</th>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</form>
